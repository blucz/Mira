"use strict";const e=require("electron"),u=require("node:os"),r=require("node:path"),w=require("fs"),f=require("url");process.env.DIST_ELECTRON=r.join(__dirname,"..");process.env.DIST=r.join(process.env.DIST_ELECTRON,"../dist");process.env.PUBLIC=process.env.VITE_DEV_SERVER_URL?r.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;u.release().startsWith("6.1")&&e.app.disableHardwareAcceleration();process.platform==="win32"&&e.app.setAppUserModelId(e.app.getName());e.app.requestSingleInstanceLock()||(e.app.quit(),process.exit(0));let n=null;const a=r.join(__dirname,"../preload/index.js"),c=process.env.VITE_DEV_SERVER_URL,p=r.join(process.env.DIST,"index.html");async function i(){n=new e.BrowserWindow({title:"Mira",icon:r.join(process.env.PUBLIC,"favicon.ico"),webPreferences:{preload:a,nodeIntegration:!0,contextIsolation:!1}}),process.env.VITE_DEV_SERVER_URL?(n.loadURL(c),n.webContents.openDevTools()):n.loadFile(p),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),n.webContents.setWindowOpenHandler(({url:o})=>(o.startsWith("https:")&&e.shell.openExternal(o),{action:"deny"}))}e.app.whenReady().then(async()=>{await i(),e.protocol.registerFileProtocol("atom",(t,l)=>{const d=f.fileURLToPath("file://"+t.url.slice(7));l(d)});const o=[{label:"File",submenu:[{label:"New",accelerator:process.platform==="darwin"?"Cmd+N":"Ctrl+N",click:i},{label:"Close",accelerator:process.platform==="darwin"?"Cmd+W":"Ctrl+W",role:"close"}]}],s=e.Menu.buildFromTemplate(o);e.Menu.setApplicationMenu(s),e.globalShortcut.register("CommandOrControl+F",()=>{n.setFullScreen(!n.isFullScreen())})});function h(o){e.shell.openPath(o).then(()=>{console.log("File opened successfully")}).catch(s=>{console.error("Error opening file:",s)})}e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F")});e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F"),n=null,process.platform!=="darwin"&&e.app.quit()});e.app.on("second-instance",()=>{n&&(n.isMinimized()&&n.restore(),n.focus())});e.app.on("activate",()=>{const o=e.BrowserWindow.getAllWindows();o.length?o[0].focus():i()});e.ipcMain.handle("open-file",(o,s)=>{const t=s.path;h(t)});e.ipcMain.handle("delete-image",(o,s)=>{const t=s.path;try{w.unlinkSync(t)}catch(l){console.error(l)}});e.ipcMain.handle("open-win",(o,s)=>{const t=new e.BrowserWindow({webPreferences:{preload:a,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?t.loadURL(`${c}#${s}`):t.loadFile(p,{hash:s})});
