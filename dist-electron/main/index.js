"use strict";const e=require("electron"),p=require("node:os"),s=require("node:path"),d=require("url");process.env.DIST_ELECTRON=s.join(__dirname,"..");process.env.DIST=s.join(process.env.DIST_ELECTRON,"../dist");process.env.PUBLIC=process.env.VITE_DEV_SERVER_URL?s.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;p.release().startsWith("6.1")&&e.app.disableHardwareAcceleration();process.platform==="win32"&&e.app.setAppUserModelId(e.app.getName());e.app.requestSingleInstanceLock()||(e.app.quit(),process.exit(0));let n=null;const r=s.join(__dirname,"../preload/index.js"),l=process.env.VITE_DEV_SERVER_URL,a=s.join(process.env.DIST,"index.html");async function c(){n=new e.BrowserWindow({title:"Main window",icon:s.join(process.env.PUBLIC,"favicon.ico"),webPreferences:{preload:r,nodeIntegration:!0,contextIsolation:!1}}),process.env.VITE_DEV_SERVER_URL?(n.loadURL(l),n.webContents.openDevTools()):n.loadFile(a),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),n.webContents.setWindowOpenHandler(({url:o})=>(o.startsWith("https:")&&e.shell.openExternal(o),{action:"deny"}))}e.app.whenReady().then(async()=>{await c(),e.protocol.registerFileProtocol("atom",(o,t)=>{const i=d.fileURLToPath("file://"+o.url.slice(7));t(i)}),e.globalShortcut.register("CommandOrControl+F",()=>{n.setFullScreen(!n.isFullScreen())})});e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F")});e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F"),n=null,process.platform!=="darwin"&&e.app.quit()});e.app.on("second-instance",()=>{n&&(n.isMinimized()&&n.restore(),n.focus())});e.app.on("activate",()=>{const o=e.BrowserWindow.getAllWindows();o.length?o[0].focus():c()});e.ipcMain.handle("open-win",(o,t)=>{const i=new e.BrowserWindow({webPreferences:{preload:r,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?i.loadURL(`${l}#${t}`):i.loadFile(a,{hash:t})});
