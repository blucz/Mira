"use strict";const e=require("electron"),d=require("node:os"),r=require("node:path"),w=require("fs"),u=require("url");process.env.DIST_ELECTRON=r.join(__dirname,"..");process.env.DIST=r.join(process.env.DIST_ELECTRON,"../dist");process.env.PUBLIC=process.env.VITE_DEV_SERVER_URL?r.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;d.release().startsWith("6.1")&&e.app.disableHardwareAcceleration();process.platform==="win32"&&e.app.setAppUserModelId(e.app.getName());e.app.requestSingleInstanceLock()||(e.app.quit(),process.exit(0));let n=null;const i=r.join(__dirname,"../preload/index.js"),l=process.env.VITE_DEV_SERVER_URL,a=r.join(process.env.DIST,"index.html");async function c(){n=new e.BrowserWindow({title:"Main window",icon:r.join(process.env.PUBLIC,"favicon.ico"),webPreferences:{preload:i,nodeIntegration:!0,contextIsolation:!1}}),process.env.VITE_DEV_SERVER_URL?(n.loadURL(l),n.webContents.openDevTools()):n.loadFile(a),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),n.webContents.setWindowOpenHandler(({url:o})=>(o.startsWith("https:")&&e.shell.openExternal(o),{action:"deny"}))}e.app.whenReady().then(async()=>{await c(),e.protocol.registerFileProtocol("atom",(o,s)=>{const t=u.fileURLToPath("file://"+o.url.slice(7));s(t)}),e.globalShortcut.register("CommandOrControl+F",()=>{n.setFullScreen(!n.isFullScreen())})});e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F")});e.app.on("window-all-closed",()=>{e.globalShortcut.unregister("CommandOrControl+F"),n=null,process.platform!=="darwin"&&e.app.quit()});e.app.on("second-instance",()=>{n&&(n.isMinimized()&&n.restore(),n.focus())});e.app.on("activate",()=>{const o=e.BrowserWindow.getAllWindows();o.length?o[0].focus():c()});e.ipcMain.handle("delete-image",(o,s)=>{const t=s.path;try{w.unlinkSync(t)}catch(p){console.error(p)}});e.ipcMain.handle("open-win",(o,s)=>{const t=new e.BrowserWindow({webPreferences:{preload:i,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?t.loadURL(`${l}#${s}`):t.loadFile(a,{hash:s})});
